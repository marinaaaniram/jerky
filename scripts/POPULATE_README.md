# 📊 Заполнение БД тестовыми данными (1000+ записей)

Этот скрипт заполняет базу данных большим количеством тестовых записей для имитации работы системы.

## 🚀 Быстрый старт

### 1. Запустить Docker контейнеры
```bash
docker-compose up --build -d
```

Подождите, пока backend инициализируется (~30 секунд):
```bash
docker logs jerky-backend -f | grep "listening on port"
```

### 2. Запустить скрипт заполнения
```bash
# Сделать скрипт исполняемым
chmod +x scripts/populate-db.sh

# Запустить с дефолтным API URL (http://localhost:3000)
bash scripts/populate-db.sh

# Или с кастомным URL
bash scripts/populate-db.sh http://your-api-url:3000
```

## 📋 Что создается?

Скрипт создает по **1000+ записей** в каждую таблицу:

| Таблица | Записей | Описание |
|---------|---------|---------|
| Users | 1000 | Пользователи с разными ролями |
| Customers | 1000 | Клиенты (DIRECT и CONSIGNMENT платежи) |
| Products | 1000 | Товары с разными ценами |
| Orders | 1000 | Заказы с товарами |
| OrderItems | 2000-5000 | Товары в заказах (2-5 за заказ) |
| Payments | 1000 | Платежи |
| PriceRules | 1000 | Специальные цены для клиентов |

**Итого: ~7000+ записей в БД**

## ⏱️ Время выполнения

- Пользователи: ~2-3 минуты
- Клиенты: ~2-3 минуты
- Товары: ~2-3 минуты
- Заказы: ~5-7 минут (создаются товары в заказах)
- Платежи: ~2-3 минуты
- Правила цен: ~2-3 минуты

**Всего: ~20-25 минут**

> 💡 Можно запустить несколько скриптов параллельно в разных терминалах для ускорения

## 🔍 Что проверить

### 1. Проверить логи скрипта
```bash
bash scripts/populate-db.sh
# Должны видеть ✅ галочки и прогресс-бары
```

### 2. Проверить в веб-приложении
```
1. Откройте http://localhost:5173
2. Войдите: ivan@jerky.com / password123
3. Перейдите на Dashboard - должны видеть большие числа
4. Откройте Заказы - должно быть 1000+ записей
5. Откройте Клиенты - должно быть 1000+ записей
6. Откройте Товары - должно быть 1000+ записей
```

### 3. Проверить в БД напрямую
```bash
# Подключиться к PostgreSQL
docker exec -it jerky-postgres psql -U jerky_user -d jerky

# Проверить количество записей
SELECT COUNT(*) FROM users;
SELECT COUNT(*) FROM customers;
SELECT COUNT(*) FROM products;
SELECT COUNT(*) FROM orders;
SELECT COUNT(*) FROM order_items;
SELECT COUNT(*) FROM payments;

# Выход
\q
```

## 🛠️ Расширенное использование

### Заполнить только определенные таблицы
Измените скрипт, закомментировав ненужные функции в `main()`:

```bash
# Только клиенты и товары:
# create_users "$TOKEN"
create_customers "$TOKEN"
create_products "$TOKEN"
# create_orders "$TOKEN"
```

### Увеличить количество записей
Измените переменную в начале скрипта:

```bash
RECORDS_PER_TABLE=5000  # Вместо 1000
```

### Использовать другой API URL
```bash
bash scripts/populate-db.sh http://production-api.com:3000
```

## ⚠️ Проблемы и решения

### ❌ "Ошибка: API недоступна"
**Решение:**
```bash
# Проверьте, запущен ли backend
docker-compose ps

# Если не запущен
docker-compose up -d backend

# Подождите инициализации
sleep 30
bash scripts/populate-db.sh
```

### ❌ "Не удалось получить токен"
**Решение:**
```bash
# Проверьте, что семена (seeders) загружены
docker logs jerky-backend | grep "seeding"

# Если нет, загрузите вручную
docker exec jerky-backend npm run seed:run
```

### ❌ "Много ошибок при создании"
**Решение:**
- Увеличьте задержку между запросами (измените PARALLEL_REQUESTS)
- Проверьте логи backend: `docker logs jerky-backend -f`
- Возможно, заполнена валидация - используйте разные данные

### ❌ "Память заканчивается"
**Решение:**
```bash
# Уменьшите количество записей
RECORDS_PER_TABLE=500

# Или запустите в несколько этапов
bash scripts/populate-db.sh  # Первый запуск
bash scripts/populate-db.sh  # Второй запуск и т.д.
```

## 📊 Пример вывода

```
════════════════════════════════════════════════════════
🚀 ЗАПОЛНЕНИЕ БД ТЕСТОВЫМИ ДАННЫМИ
════════════════════════════════════════════════════════
ℹ️  API URL: http://localhost:3000
ℹ️  Количество записей на таблицу: 1000

ℹ️  Получение токена аутентификации...
✅ Токен получен: eyJhbGciOiJIUzI1NiIs...

════════════════════════════════════════════════════════
СОЗДАНИЕ ПОЛЬЗОВАТЕЛЕЙ (1000 шт)
════════════════════════════════════════════════════════
[============================] 100% (1000/1000)
✅ Создано пользователей: 1000

════════════════════════════════════════════════════════
СОЗДАНИЕ КЛИЕНТОВ (1000 шт)
════════════════════════════════════════════════════════
[============================] 100% (1000/1000)
✅ Создано клиентов: 1000

... [аналогично для остальных таблиц]

════════════════════════════════════════════════════════
📊 ИТОГОВЫЙ ОТЧЕТ
════════════════════════════════════════════════════════

✅ Всего создано: 7000 записей
❌ Всего ошибок: 5

✅ База данных успешно заполнена!
ℹ️  Приложение готово к работе: http://localhost:3000
```

## 🎯 Что дальше?

1. **Тестировать приложение** с реалистичными данными
2. **Проверить производительность** - как приложение работает с 7000+ записей
3. **Тестировать фильтры и сортировку** - работают ли быстро с большим объемом
4. **Проверить аналитику** - посчитайте метрики на Dashboard

## 🔄 Повторное заполнение

Если нужно заполнить БД заново:

```bash
# 1. Удалить все контейнеры и volume
docker-compose down -v

# 2. Перестроить и запустить
docker-compose up --build -d

# 3. Заполнить БД
bash scripts/populate-db.sh
```

---

**Готово! База данных теперь готова к работе с реалистичными данными 🚀**
